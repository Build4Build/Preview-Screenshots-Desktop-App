<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Preview Screenshots - Test Suite</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 20px;
            background: #f5f5f7;
        }
        .test-container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .test-header {
            color: #1d1d1f;
            margin-bottom: 16px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        .test-btn {
            background: #007aff;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 16px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }
        .test-btn:hover {
            background: #0056cc;
        }
        .test-btn.success {
            background: #34c759;
        }
        .test-btn.error {
            background: #ff3b30;
        }
        .canvas-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        #testCanvas {
            border: 2px solid #007aff;
            border-radius: 8px;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 12px;
            font-family: Monaco, monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 12px;
        }
        .log-entry {
            margin-bottom: 4px;
        }
        .log-success { color: #28a745; }
        .log-error { color: #dc3545; }
        .log-info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-header">üß™ Preview Screenshots Maker - Test Suite</h1>
        <p>Complete functionality test for the Canvas-based screenshot maker.</p>
    </div>

    <div class="test-container">
        <h2 class="test-header">üìã Basic Tests</h2>
        <div class="test-grid">
            <button class="test-btn" id="testCanvas">Test Canvas Creation</button>
            <button class="test-btn" id="testText">Test Text Addition</button>
            <button class="test-btn" id="testShape">Test Shape Addition</button>
            <button class="test-btn" id="testBackground">Test Background</button>
            <button class="test-btn" id="testClear">Test Clear Canvas</button>
            <button class="test-btn" id="testExport">Test Export</button>
        </div>
    </div>

    <div class="test-container">
        <h2 class="test-header">üé® Template Tests</h2>
        <div class="test-grid">
            <button class="test-btn" id="testHeroTemplate">Hero Template</button>
            <button class="test-btn" id="testFeatureTemplate">Features Template</button>
            <button class="test-btn" id="testDeviceSwitch">Device Switch</button>
            <button class="test-btn" id="runAllTests">üöÄ Run All Tests</button>
        </div>
    </div>

    <div class="test-container">
        <h2 class="test-header">üñºÔ∏è Live Canvas</h2>
        <div class="canvas-container">
            <canvas id="testCanvas" width="400" height="600"></canvas>
        </div>
        <div style="text-align: center;">
            <strong>Canvas Size:</strong> 400 √ó 600 (scaled for testing)
        </div>
    </div>

    <div class="test-container">
        <h2 class="test-header">üìù Test Log</h2>
        <div id="testLog" class="log"></div>
        <button class="test-btn" id="clearLog" style="margin-top: 12px;">Clear Log</button>
    </div>

    <script>
        // Test Suite for Preview Screenshots Maker
        let testCanvas;
        let testResults = {};

        // Logging function
        function log(message, type = 'info') {
            const logElement = document.getElementById('testLog');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(`[TEST] ${message}`);
        }

        // Initialize test canvas
        function initTestCanvas() {
            log('Initializing test canvas...', 'info');
            
            try {
                testCanvas = new fabric.Canvas('testCanvas', {
                    width: 400,
                    height: 600,
                    backgroundColor: '#ffffff'
                });
                
                log('‚úÖ Test canvas created successfully', 'success');
                updateButtonStatus('testCanvas', 'success');
                testResults.canvas = true;
                return true;
            } catch (error) {
                log(`‚ùå Failed to create canvas: ${error.message}`, 'error');
                updateButtonStatus('testCanvas', 'error');
                testResults.canvas = false;
                return false;
            }
        }

        // Update button visual status
        function updateButtonStatus(buttonId, status) {
            const button = document.getElementById(buttonId);
            if (button) {
                button.classList.remove('success', 'error');
                button.classList.add(status);
            }
        }

        // Test text addition
        function testTextAddition() {
            log('Testing text addition...', 'info');
            
            if (!testCanvas) {
                log('‚ùå Canvas not initialized', 'error');
                return false;
            }

            try {
                const text = new fabric.Text('Test App Title', {
                    left: testCanvas.width / 2,
                    top: testCanvas.height * 0.2,
                    fontFamily: 'SF Pro Display, -apple-system, sans-serif',
                    fontSize: 24,
                    fill: '#1d1d1f',
                    textAlign: 'center',
                    originX: 'center',
                    originY: 'center'
                });

                testCanvas.add(text);
                testCanvas.renderAll();
                
                log('‚úÖ Text added successfully', 'success');
                updateButtonStatus('testText', 'success');
                testResults.text = true;
                return true;
            } catch (error) {
                log(`‚ùå Failed to add text: ${error.message}`, 'error');
                updateButtonStatus('testText', 'error');
                testResults.text = false;
                return false;
            }
        }

        // Test shape addition
        function testShapeAddition() {
            log('Testing shape addition...', 'info');
            
            if (!testCanvas) {
                log('‚ùå Canvas not initialized', 'error');
                return false;
            }

            try {
                const rect = new fabric.Rect({
                    left: testCanvas.width / 2,
                    top: testCanvas.height / 2,
                    width: 100,
                    height: 60,
                    fill: '#007aff',
                    originX: 'center',
                    originY: 'center',
                    rx: 8,
                    ry: 8
                });

                testCanvas.add(rect);
                testCanvas.renderAll();
                
                log('‚úÖ Shape added successfully', 'success');
                updateButtonStatus('testShape', 'success');
                testResults.shape = true;
                return true;
            } catch (error) {
                log(`‚ùå Failed to add shape: ${error.message}`, 'error');
                updateButtonStatus('testShape', 'error');
                testResults.shape = false;
                return false;
            }
        }

        // Test background change
        function testBackground() {
            log('Testing background change...', 'info');
            
            if (!testCanvas) {
                log('‚ùå Canvas not initialized', 'error');
                return false;
            }

            try {
                testCanvas.setBackgroundColor('#f0f8ff', testCanvas.renderAll.bind(testCanvas));
                
                setTimeout(() => {
                    testCanvas.setBackgroundColor('#ffffff', testCanvas.renderAll.bind(testCanvas));
                }, 1000);
                
                log('‚úÖ Background changed successfully', 'success');
                updateButtonStatus('testBackground', 'success');
                testResults.background = true;
                return true;
            } catch (error) {
                log(`‚ùå Failed to change background: ${error.message}`, 'error');
                updateButtonStatus('testBackground', 'error');
                testResults.background = false;
                return false;
            }
        }

        // Test canvas clear
        function testClear() {
            log('Testing canvas clear...', 'info');
            
            if (!testCanvas) {
                log('‚ùå Canvas not initialized', 'error');
                return false;
            }

            try {
                testCanvas.clear();
                testCanvas.setBackgroundColor('#ffffff', testCanvas.renderAll.bind(testCanvas));
                
                log('‚úÖ Canvas cleared successfully', 'success');
                updateButtonStatus('testClear', 'success');
                testResults.clear = true;
                return true;
            } catch (error) {
                log(`‚ùå Failed to clear canvas: ${error.message}`, 'error');
                updateButtonStatus('testClear', 'error');
                testResults.clear = false;
                return false;
            }
        }

        // Test export
        function testExport() {
            log('Testing export functionality...', 'info');
            
            if (!testCanvas) {
                log('‚ùå Canvas not initialized', 'error');
                return false;
            }

            try {
                const dataURL = testCanvas.toDataURL({
                    format: 'png',
                    quality: 1
                });
                
                if (dataURL && dataURL.startsWith('data:image/png')) {
                    log('‚úÖ Export successful', 'success');
                    updateButtonStatus('testExport', 'success');
                    testResults.export = true;
                    return true;
                } else {
                    throw new Error('Invalid data URL generated');
                }
            } catch (error) {
                log(`‚ùå Failed to export: ${error.message}`, 'error');
                updateButtonStatus('testExport', 'error');
                testResults.export = false;
                return false;
            }
        }

        // Test hero template
        function testHeroTemplate() {
            log('Testing Hero template...', 'info');
            
            if (!testCanvas) {
                log('‚ùå Canvas not initialized', 'error');
                return false;
            }

            try {
                testCanvas.clear();
                testCanvas.setBackgroundColor('#ffffff', testCanvas.renderAll.bind(testCanvas));

                // Add title
                const title = new fabric.Text('Amazing App', {
                    left: testCanvas.width / 2,
                    top: testCanvas.height * 0.15,
                    fontFamily: 'SF Pro Display, -apple-system, sans-serif',
                    fontSize: 32,
                    fontWeight: 'bold',
                    fill: '#1d1d1f',
                    textAlign: 'center',
                    originX: 'center',
                    originY: 'center'
                });

                // Add subtitle
                const subtitle = new fabric.Text('Transform your workflow', {
                    left: testCanvas.width / 2,
                    top: testCanvas.height * 0.25,
                    fontFamily: 'SF Pro Display, -apple-system, sans-serif',
                    fontSize: 16,
                    fill: '#86868b',
                    textAlign: 'center',
                    originX: 'center',
                    originY: 'center'
                });

                testCanvas.add(title);
                testCanvas.add(subtitle);
                testCanvas.renderAll();
                
                log('‚úÖ Hero template loaded successfully', 'success');
                updateButtonStatus('testHeroTemplate', 'success');
                testResults.heroTemplate = true;
                return true;
            } catch (error) {
                log(`‚ùå Failed to load Hero template: ${error.message}`, 'error');
                updateButtonStatus('testHeroTemplate', 'error');
                testResults.heroTemplate = false;
                return false;
            }
        }

        // Test features template
        function testFeatureTemplate() {
            log('Testing Features template...', 'info');
            
            if (!testCanvas) {
                log('‚ùå Canvas not initialized', 'error');
                return false;
            }

            try {
                testCanvas.clear();
                testCanvas.setBackgroundColor('#ffffff', testCanvas.renderAll.bind(testCanvas));

                // Add features title
                const title = new fabric.Text('‚ú® Key Features', {
                    left: testCanvas.width / 2,
                    top: testCanvas.height * 0.1,
                    fontFamily: 'SF Pro Display, -apple-system, sans-serif',
                    fontSize: 24,
                    fontWeight: 'bold',
                    fill: '#1d1d1f',
                    textAlign: 'center',
                    originX: 'center',
                    originY: 'center'
                });

                // Add features list
                const features = new fabric.Text('üöÄ Fast & Reliable\nüì± Beautiful Design\nüîí Secure & Private', {
                    left: testCanvas.width / 2,
                    top: testCanvas.height * 0.4,
                    fontFamily: 'SF Pro Display, -apple-system, sans-serif',
                    fontSize: 18,
                    fill: '#007aff',
                    textAlign: 'center',
                    originX: 'center',
                    originY: 'center'
                });

                testCanvas.add(title);
                testCanvas.add(features);
                testCanvas.renderAll();
                
                log('‚úÖ Features template loaded successfully', 'success');
                updateButtonStatus('testFeatureTemplate', 'success');
                testResults.featureTemplate = true;
                return true;
            } catch (error) {
                log(`‚ùå Failed to load Features template: ${error.message}`, 'error');
                updateButtonStatus('testFeatureTemplate', 'error');
                testResults.featureTemplate = false;
                return false;
            }
        }

        // Test device switch
        function testDeviceSwitch() {
            log('Testing device size switch...', 'info');
            
            if (!testCanvas) {
                log('‚ùå Canvas not initialized', 'error');
                return false;
            }

            try {
                // Simulate iPhone 15 Pro size (scaled)
                testCanvas.setDimensions({ width: 400, height: 600 });
                
                setTimeout(() => {
                    // Simulate iPhone 15 size (scaled)
                    testCanvas.setDimensions({ width: 400, height: 580 });
                    testCanvas.renderAll();
                    
                    log('‚úÖ Device switch test completed', 'success');
                    updateButtonStatus('testDeviceSwitch', 'success');
                    testResults.deviceSwitch = true;
                }, 500);
                
                return true;
            } catch (error) {
                log(`‚ùå Failed device switch test: ${error.message}`, 'error');
                updateButtonStatus('testDeviceSwitch', 'error');
                testResults.deviceSwitch = false;
                return false;
            }
        }

        // Run all tests
        function runAllTests() {
            log('üöÄ Starting comprehensive test suite...', 'info');
            testResults = {};
            
            // Reset all button states
            document.querySelectorAll('.test-btn').forEach(btn => {
                btn.classList.remove('success', 'error');
            });

            // Run tests in sequence
            setTimeout(() => {
                if (initTestCanvas()) {
                    setTimeout(() => testTextAddition(), 500);
                    setTimeout(() => testShapeAddition(), 1000);
                    setTimeout(() => testBackground(), 1500);
                    setTimeout(() => testClear(), 2500);
                    setTimeout(() => testExport(), 3000);
                    setTimeout(() => testHeroTemplate(), 3500);
                    setTimeout(() => testFeatureTemplate(), 4500);
                    setTimeout(() => testDeviceSwitch(), 5500);
                    setTimeout(() => showTestSummary(), 6500);
                }
            }, 100);
        }

        // Show test summary
        function showTestSummary() {
            const passed = Object.values(testResults).filter(result => result === true).length;
            const total = Object.keys(testResults).length;
            
            if (passed === total) {
                log(`üéâ ALL TESTS PASSED! (${passed}/${total})`, 'success');
                updateButtonStatus('runAllTests', 'success');
            } else {
                log(`‚ö†Ô∏è Tests completed: ${passed}/${total} passed`, 'error');
                updateButtonStatus('runAllTests', 'error');
            }
            
            log('üìä Test Results:', 'info');
            Object.entries(testResults).forEach(([test, result]) => {
                log(`  ${test}: ${result ? '‚úÖ PASS' : '‚ùå FAIL'}`, result ? 'success' : 'error');
            });
        }

        // Setup event listeners
        document.addEventListener('DOMContentLoaded', () => {
            log('üß™ Test Suite Ready', 'info');
            
            // Button event listeners
            document.getElementById('testCanvas').addEventListener('click', initTestCanvas);
            document.getElementById('testText').addEventListener('click', testTextAddition);
            document.getElementById('testShape').addEventListener('click', testShapeAddition);
            document.getElementById('testBackground').addEventListener('click', testBackground);
            document.getElementById('testClear').addEventListener('click', testClear);
            document.getElementById('testExport').addEventListener('click', testExport);
            document.getElementById('testHeroTemplate').addEventListener('click', testHeroTemplate);
            document.getElementById('testFeatureTemplate').addEventListener('click', testFeatureTemplate);
            document.getElementById('testDeviceSwitch').addEventListener('click', testDeviceSwitch);
            document.getElementById('runAllTests').addEventListener('click', runAllTests);
            
            document.getElementById('clearLog').addEventListener('click', () => {
                document.getElementById('testLog').innerHTML = '';
                log('Test log cleared', 'info');
            });

            // Auto-initialize canvas
            setTimeout(initTestCanvas, 1000);
        });
    </script>
</body>
</html>
