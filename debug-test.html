<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Debug Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <style>
        body {
            margin: 20px;
            font-family: Arial, sans-serif;
        }
        
        .test-canvas {
            border: 2px solid #ccc;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .controls {
            margin: 20px 0;
        }
        
        button {
            margin: 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: #007AFF;
            color: white;
            cursor: pointer;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Canvas Rendering Debug Test</h1>
    
    <div class="info">
        <p><strong>Status:</strong> <span id="status">Initializing...</span></p>
        <p><strong>Objects on canvas:</strong> <span id="objectCount">0</span></p>
    </div>
    
    <div class="controls">
        <button onclick="testBasicText()">Test Basic Text</button>
        <button onclick="testBasicShape()">Test Basic Shape</button>
        <button onclick="testSimpleTemplate()">Test Simple Template</button>
        <button onclick="clearCanvas()">Clear Canvas</button>
    </div>
    
    <canvas id="debug-canvas" class="test-canvas" width="400" height="600"></canvas>
    
    <script>
        let canvas;
        
        // Initialize canvas
        document.addEventListener('DOMContentLoaded', () => {
            try {
                canvas = new fabric.Canvas('debug-canvas', {
                    backgroundColor: '#ffffff',
                    preserveObjectStacking: true,
                    selection: true
                });
                
                canvas.on('object:added', updateStatus);
                canvas.on('object:removed', updateStatus);
                
                updateStatus();
                document.getElementById('status').textContent = 'Canvas initialized successfully';
                
            } catch (error) {
                console.error('Canvas initialization failed:', error);
                document.getElementById('status').textContent = 'Canvas initialization failed: ' + error.message;
            }
        });
        
        function updateStatus() {
            const count = canvas ? canvas.getObjects().length : 0;
            document.getElementById('objectCount').textContent = count;
        }
        
        function testBasicText() {
            console.log('Testing basic text...');
            try {
                const text = new fabric.Text('Hello World!', {
                    left: 200,
                    top: 100,
                    originX: 'center',
                    originY: 'center',
                    fontSize: 32,
                    fill: '#000000',
                    fontFamily: 'Arial'
                });
                
                canvas.add(text);
                canvas.renderAll();
                console.log('Text added successfully');
                
            } catch (error) {
                console.error('Text test failed:', error);
                document.getElementById('status').textContent = 'Text test failed: ' + error.message;
            }
        }
        
        function testBasicShape() {
            console.log('Testing basic shape...');
            try {
                const rect = new fabric.Rect({
                    left: 200,
                    top: 200,
                    originX: 'center',
                    originY: 'center',
                    width: 100,
                    height: 100,
                    fill: '#007AFF',
                    rx: 10,
                    ry: 10
                });
                
                canvas.add(rect);
                canvas.renderAll();
                console.log('Shape added successfully');
                
            } catch (error) {
                console.error('Shape test failed:', error);
                document.getElementById('status').textContent = 'Shape test failed: ' + error.message;
            }
        }
        
        function testSimpleTemplate() {
            console.log('Testing simple template...');
            try {
                // Clear canvas first
                canvas.clear();
                
                // Set background
                canvas.setBackgroundColor('#667eea');
                
                // Add title
                const title = new fabric.Text('Test Template', {
                    left: 200,
                    top: 50,
                    originX: 'center',
                    originY: 'center',
                    fontSize: 24,
                    fill: '#ffffff',
                    fontFamily: 'Arial'
                });
                
                // Add subtitle
                const subtitle = new fabric.Text('This is a test', {
                    left: 200,
                    top: 100,
                    originX: 'center',
                    originY: 'center',
                    fontSize: 16,
                    fill: '#ffffff',
                    fontFamily: 'Arial'
                });
                
                // Add shape
                const shape = new fabric.Rect({
                    left: 200,
                    top: 200,
                    originX: 'center',
                    originY: 'center',
                    width: 150,
                    height: 250,
                    fill: '#ffffff',
                    rx: 15,
                    ry: 15
                });
                
                canvas.add(title);
                canvas.add(subtitle);
                canvas.add(shape);
                
                canvas.renderAll();
                console.log('Template test completed');
                
            } catch (error) {
                console.error('Template test failed:', error);
                document.getElementById('status').textContent = 'Template test failed: ' + error.message;
            }
        }
        
        function clearCanvas() {
            if (canvas) {
                canvas.clear();
                canvas.setBackgroundColor('#ffffff');
                canvas.renderAll();
                console.log('Canvas cleared');
            }
        }
    </script>
</body>
</html>
